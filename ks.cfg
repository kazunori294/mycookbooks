#kickstart file automatically generated by anaconda.

#version=DEVEL
install
url --url=http://10.1.0.2/centos6
lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --bootproto dhcp --noipv6
rootpw  --iscrypted $6$WuOrTh90AnsCTDux$o90yJHujaQfxsy79FSt4JnOC1JSBNjsvsCRQluewJx86VDzW8xvpnqER1jzyGxujZJKa1Q9Fc1awZjszQyEQH1
firewall --disabled
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone --utc Asia/Tokyo
bootloader --location=mbr --driveorder=sda --append="crashkernel=auto rhgb quiet console=ttyS0,9600"
text
reboot

# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work

zerombr
clearpart --all --initlabel

part /boot --fstype=ext4 --size=500
part pv.008002 --grow --size=1

volgroup vg_centos --pesize=4096 pv.008002
logvol / --fstype=ext4 --name=lv_root --vgname=vg_centos --grow --size=1024 --maxsize=51200
logvol swap --name=lv_swap --vgname=vg_centos --grow --size=2016 --maxsize=4032

#volgroup VolGroup --pesize=4096 pv.008002
#logvol / --fstype=ext4 --name=lv_root --vgname=VolGroup --grow --size=1024 --maxsize=51200
#logvol swap --name=lv_swap --vgname=VolGroup --grow --size=992 --maxsize=992
#part /boot --fstype=ext4 --size=500
#part pv.008002 --grow --size=1


repo --name="CentOS"  --baseurl=http://10.1.0.2/centos6 --cost=100

%packages --nobase
@core


%post
yum install -y wget
yum install -y perl
yum install -y crontabs
yum install -y sudo
yum install -y git
rpm -ivh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
yum install -y sshpass

cd /tmp; wget 10.1.0.2/tools/VMwareTools-9.4.0-1252860.tar.gz; tar zxf VMwareTools-9.4.0-1252860.tar.gz
/tmp/vmware-tools-distrib/vmware-install.pl -d 
rm -rf /tmp/*

cd /root; mkdir script
cd /root/script; wget 10.1.0.2/scripts/autoreg.sh
chmod 777 autoreg.sh
sh /root/script/autoreg.sh
echo '*/5 * * * *  sh /root/script/autoreg.sh' >>  /var/spool/cron/root
service crond start
chkconfig crond on

mkdir /root/.ssh
wget -O /root/.ssh/id_rsa  10.1.0.2/tools/github_key
chmod 600 /root/.ssh/id_rsa


curl -L http://www.opscode.com/chef/install.sh | sudo bash
/opt/chef/embedded/bin/gem install knife-solo --no-ri --no-rdoc
cd /root/
knife solo init chef-repo
cd /root/chef-repo
git clone https://github.com/kazunori294/mycookbooks.git
wget 10.1.0.2/scripts/solo.rb
echo '*/5 * * * *  cd /root/chef-repo/mycookbooks && git pull' >>  /var/spool/cron/root


cd /tmp
git clone https://github.com/kazunori294/zabbix.git
cd /tmp/zabbix
sh install_agent.sh



%end
